// Add steps as necessary for accessing the software, post-configuration, and testing. Donâ€™t include full usage instructions for your software, but add links to your product documentation for that information.
//Should any sections not be applicable, remove them

=== Testing the deployment
// If steps are required to test the deployment, add them here. If not, remove the heading
:xrefstyle: short
To test the deployment, first ensure that your IP address is entered in the WebAccessCIDR parameter. If so, you can enter the URL of your Elastic Load Balancer (part of the output of the WebAutoScaleStack) in a web browser. The window shown in <<#sample-web-page>> will display.

[#sample-web-page]
.Test page
[link=images/SampleWebPage.png]
image::../images/SampleWebPage.png[Sample Web Page,width=100%,height=100%]

NOTE: If you are unable to connect to the test page, review the security groups for the ELBs and verify they have the correct CIDR ranges.

== Using AWS Systems Manager Session Manager

This Quick Start deploys AWS Systems Manager Agent (SSM Agent) on all EC2 instances. With SSM Agent, you can use the Windows remote desktop protocol (RDP) to connect to them without the need for an RDP bastion host or opening inbound port 3389 with Session Manager. This section explains the requirements for using this feature and how to connect to an EC2 instance of Windows Server using RDP.

NOTE: See https://docs.aws.amazon.com/systems-manager/latest/userguide/what-is-systems-manager.html[What is Systems Manager?], https://docs.aws.amazon.com/systems-manager/latest/userguide/session-manager.htmlAWS[Systems Manager Session Manager], and https://docs.aws.amazon.com/systems-manager/latest/userguide/prereqs-ssm-agent.html[AWS Systems Manager Agent (SSM Agent)] for more information.

==== Prerequisites
You must complete the following:

 * https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-welcome.html[AWS Command Line Interface] must be installed on your desktop.
 * https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-configure.html#cli-quick-configuration[AWS Command Line Interface (AWS CLI)] must be configured with security credentials for your AWS account.
 * https://docs.aws.amazon.com/systems-manager/latest/userguide/session-manager-working-with-install-plugin.html#install-plugin-windows[Session Manager plugin] for AWS CLI must be installed.

These prerequisites are completed automatically by deploying the Quick Start:

 * SSM Agent must be installed on EC2 instances.*
 * Instance role attached allowing access to Systems Manager API.*

==== Connecting to a Windows instance with RDP

:xrefstyle: short
. Start a port forwarding session. 
.. Browse to the https://console.aws.amazon.com/ec2/[Amazon EC2 Console] and note the instance ID (for example, "i-1234567890abcdef0").
.. Run the following command in the AWS CLI, inputting your target instance id after the --target parameter. (See <<start-session>>.)
.. Open the Remote Desktop application on your local machine.
.. Point to the local port of the session, which forwards you on to the instance.

[source,bash]
....
aws ssm start-session --target "<your-instance-id>" --document-name AWS-StartPortForwardingSession --parameters "portNumber"=["3389"],"localPortNumber"=["56788"]
....

[#start-session]
.CLI Command to port forward a local port to RDP on an EC2 Instance
[link=images/clisessionmanager.png]
image::../images/clisessionmanager.png[Start Session,width=100%,height=100%]

[start=2]
. Once the session is established, open your Remote Desktop application and enter localhost:56788.
. Select *Connect*.

[#rdp-session]
.Connecting to localhost:56788
[link=images/rdpgraphic.png]
image::../images/rdpgraphic.png[RDP,width=100%,height=100%]

NOTE: You can use any local port number not currently in use.

[start=3]
. When the client prompts you for credentials, enter the appropriate password to log in.

[#connected-EC2]
.Connected to EC2 instance with RDP
[link=images/loggedin.png]
image::../images/loggedin.png[RDP,width=100%,height=100%]

[start=4]
. Once you are done you can terminate the session.

[#disconnected-session]
.Disconnect Session
[link=images/rdp5.png]
image::../images/rdp5.png[RDP,width=100%,height=100%]

== Post-deployment steps
If you want to make the Quick Start your own, take a look at the https://github.com/aws-quickstart/quickstart-microsoft-iis/blob/main/templates/automation-parts.template.yaml[automation-parts.template.yaml]. This Cloudformation template uploads all the MOF files that support the Quick Starts as well as creates the automation documents that are triggered by the lifecycle hooks of the Auto Scaling group. 

The following code block demonstrates a step in the AWS Systems Manager automation document. These steps under the *main step* section can be added to or modified to support your own automation steps and configuration.

[source,yaml]
....
- name: "setNameTag"
  action: aws:runCommand
  onFailure: "step:abandonHookAction"
  inputs:
    DocumentName: AWS-RunPowerShellScript
    InstanceIds: 
      - "{{InstanceId}}"
    CloudWatchOutputConfig:
      CloudWatchOutputEnabled: "true"
      CloudWatchLogGroupName: "/QuickStart/SetupConfiguration"
    Parameters:
      commands: 
        - |
           Import-Module AWSPowerShell
           $instanceid = (Invoke-RestMethod -Method Get -Uri http://169.254.169.254/latest/meta-data/instance-id)
           New-EC2Tag -Resource $instanceId -Tag @{Key="Name";Value=$env:COMPUTERNAME}
....

NOTE: For more information on what you can do in an automation document, see https://docs.aws.amazon.com/systems-manager/latest/userguide/automation-actions.html[Systems Manager Automation actions reference].

== Best practices for using {partner-product-short-name} on AWS
// Provide post-deployment best practices for using the technology on AWS, including considerations such as migrating data, backups, ensuring high performance, high availability, etc. Link to software documentation for detailed information.

See the following sites for practices to help you get the best results from running Windows on Amazon EC2:

* https://docs.aws.amazon.com/AWSEC2/latest/WindowsGuide/ec2-best-practices.html[Best practices for Windows on Amazon EC2].
* https://techcommunity.microsoft.com/t5/core-infrastructure-and-security/iis-best-practices/ba-p/1241577[IIS Best Practices]
* https://docs.microsoft.com/en-us/iis/get-started/whats-new-in-iis-10-version-1709/new-features-introduced-in-iis-10-1709[New Features Introduced in IIS 10.0 Version 1709]. 


== Modifying the Windows Server version
//Provide any other information of interest to users, especially focusing on areas where AWS or cloud usage differs from on-premises usage.

This Quick Start launches with Windows Server 2019 Core AMI, the AMI includes the license for Windows Server and is updated on a regular basis with the latest service pack for the operating system. If you would like to modify the Windows Server version modify the ImageId parameter in /templates/asg-lch.template.yaml. For a list of Windows images you can run the following command from the AWS CLI:
[source,bash]
....
aws ssm get-parameters-by-path --path "/aws/service/ami-windows-latest" --region us-east-1
....
